<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pong Game</title>
<style>
	body {
	  background: black;
	  color: red;
	  font-family: monospace;
	  text-align: center;
	  margin: 0;
	  padding: 0;
	}
	canvas {
	  background: black;
	  display: block;
	  margin: 40px auto;
	  border: 3px solid red;
	  box-shadow: 0 0 20px red;
	}
	#score {
	  font-size: 2rem;
	  text-shadow: 0 0 10px red;
	}
  </style>
</head>
<body>
<canvas id="pong" width="1000" height="500"></canvas>
<button onclick="update()">Play</button>
<script>

// me
function drawLine(context, x1, y1, x2, y2, color = "white", width = 2) {
    context.beginPath();
    context.moveTo(x1, y1);
    context.lineTo(x2, y2);
    context.strokeStyle = color;
    context.lineWidth = width;
    context.stroke();
}
function drawCircle(context, x, y, radius, color = "white", fill = true, lineWidth = 2) {
    context.beginPath();
    context.arc(x, y, radius, 0, Math.PI * 2);
    if (fill) {
        context.fillStyle = color;
        context.fill();
    } else {
        context.strokeStyle = color;
        context.lineWidth = lineWidth;
        context.stroke();
    }
}
//

const canvas = document.getElementById("pong");
const context = canvas.getContext("2d");

const scale = 1;

const paddleWidth = 15 * scale;
const paddleHeight = 150 * scale;
const ballSize = 15 * scale;

let leftPaddle = {
	x: 0, 
	y: canvas.height / 2 - paddleHeight / 2, 
	dy: 0 
};
let rightPaddle = { 
	x: canvas.width - paddleWidth, 
	y: canvas.height / 2 - paddleHeight / 2, 
	dy: 0
};
let ball = { 
	x: canvas.width / 2, 
	y: canvas.height / 2, 
	dx: 4 * (Math.random() > 0.5 ? 1 : -1),
	dy: 4 * (Math.random() > 0.5 ? 1 : -1)
};

const speed = 5;

function draw() {
	context.clearRect(0, 0, canvas.width, canvas.height);
	context.fillStyle = "red"; 

	context.fillRect(leftPaddle.x, leftPaddle.y, paddleWidth, paddleHeight);
	context.fillRect(rightPaddle.x, rightPaddle.y, paddleWidth, paddleHeight);
	context.fillRect(ball.x, ball.y, ballSize, ballSize);

	const dashHeight = 15;
    const gap = 7;
	for (let y = 0; y < canvas.height; y += dashHeight + gap)
		drawLine(context, canvas.width / 2, y, canvas.width / 2, y + dashHeight, "red", 3);
	drawCircle(context, canvas.width / 2, canvas.height / 2, 60, "red", false, 3);
}

function movePaddles() {
	leftPaddle.y += leftPaddle.dy;
	rightPaddle.y += rightPaddle.dy;

	if (leftPaddle.y < 0) leftPaddle.y = 0;
	if (leftPaddle.y + paddleHeight > canvas.height) leftPaddle.y = canvas.height - paddleHeight;
	if (rightPaddle.y < 0) rightPaddle.y = 0;
	if (rightPaddle.y + paddleHeight > canvas.height) rightPaddle.y = canvas.height - paddleHeight;
}

function moveBall() {
	ball.x += ball.dx;
	ball.y += ball.dy;

	if (ball.y <= 0 || ball.y + ballSize >= canvas.height) {
		ball.dy = -ball.dy;
	}

	if (
		(ball.x <= leftPaddle.x + paddleWidth && ball.x >= leftPaddle.x &&
		ball.y + ballSize >= leftPaddle.y && ball.y <= leftPaddle.y + paddleHeight) ||
		(ball.x + ballSize >= rightPaddle.x && ball.x + ballSize <= rightPaddle.x + paddleWidth &&
		ball.y + ballSize >= rightPaddle.y && ball.y <= rightPaddle.y + paddleHeight)
	)
	{
		ball.dx = -ball.dx;
	}

	if (ball.x < 0 || ball.x > canvas.width) {

		// score
		if (ball.x < 0)
			console.log("1 point for right");
		else
			console.log("1 point for left");

		ball.x = canvas.width / 2;
		ball.y = canvas.height / 2;
		ball.dx = 4 * (Math.random() > 0.5 ? 1 : -1);
		ball.dy = 4 * (Math.random() > 0.5 ? 1 : -1);
	}
}

let counter = 0;

function update() {
	movePaddles();
	moveBall();
	draw();

	counter++;
	console.debug(`--- Game State ${counter} ---`);
	
	// for 60 fps
	// not working when tab is inactive
	// smooth animation
	requestAnimationFrame(update);
}

document.addEventListener("keydown", (e) => {
	switch (e.key) {
		case "ArrowUp": rightPaddle.dy = -speed; break;
		case "ArrowDown": rightPaddle.dy = speed; break;
		case "w": leftPaddle.dy = -speed; break;
		case "s": leftPaddle.dy = speed; break;
	}
});

// start
update();

</script>
</body>
</html>
